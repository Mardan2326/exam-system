# ❌ AI解析失败 - 问题排查指南

## 🔍 问题诊断步骤

### 步骤 1: 打开浏览器开发者工具
**按 F12** 或 **右键 → 检查** 打开开发者工具

### 步骤 2: 查看 Console（控制台）标签
查找**红色错误信息**，常见错误类型：

#### A. CORS 跨域错误
```
Access to fetch at 'http://127.0.0.1:5000/parse' from origin 'file://' 
has been blocked by CORS policy
```
**解决方法：**
- 确认 server.py 中有 `CORS(app)` 这一行
- 重启服务器

#### B. 网络连接错误
```
Failed to fetch
net::ERR_CONNECTION_REFUSED
```
**解决方法：**
- 确认服务器正在运行：`python server.py`
- 检查端口：`netstat -ano | findstr 5000`

#### C. PDF.js 加载失败
```
pdfjsLib is not defined
```
**解决方法：**
- 检查网络连接（需要从 CDN 加载）
- 尝试更换 CDN 或下载本地版本

#### D. 超时错误
```
AbortError: The operation was aborted
```
**解决方法：**
- DeepSeek 处理时间过长
- 减少 PDF 页数
- 检查网络连接到 DeepSeek API

### 步骤 3: 查看 Network（网络）标签
1. 刷新页面
2. 点击"AI解析"按钮
3. 查看 `/parse` 请求

**检查项：**
- **Status（状态）**: 应该是 200
- **Type**: 应该是 `fetch`
- **Size**: 应该有数据返回
- **Time**: 查看响应时间

**可能的状态：**
- `(failed)` - 连接失败，服务器未运行
- `(canceled)` - 请求被取消
- `CORS error` - 跨域问题
- `200 OK` - 正常（如果还报错，是前端 JS 问题）

### 步骤 4: 强制刷新页面
按 **Ctrl + Shift + R** (Windows) 或 **Cmd + Shift + R** (Mac)
清除浏览器缓存，加载最新版本

## 🛠️ 快速修复方法

### 方法 1: 重启服务器
```bash
# 停止所有 Python 进程
taskkill /F /IM python.exe

# 重新启动服务器
python server.py
```

### 方法 2: 使用不同的浏览器
尝试使用：
- ✅ Chrome（推荐）
- ✅ Edge
- ⚠️ Firefox（可能有 CORS 限制）
- ❌ IE（不支持）

### 方法 3: 检查防火墙
Windows 防火墙可能阻止 Python：
1. 打开 Windows 安全中心
2. 防火墙和网络保护
3. 允许应用通过防火墙
4. 找到 Python，勾选"专用"和"公用"

### 方法 4: 更换端口
如果 5000 端口被占用，修改 `server.py`：
```python
app.run(host='0.0.0.0', port=5001, debug=False)  # 改为 5001
```

然后修改 `Exam.html` 中所有的 `5000` 为 `5001`

## 📋 诊断清单

请逐一检查：

- [ ] 服务器正在运行（`python server.py` 没有错误）
- [ ] 端口 5000 处于监听状态（`netstat -ano | findstr 5000`）
- [ ] 浏览器是 Chrome 或 Edge
- [ ] 已经强制刷新页面（Ctrl+Shift+R）
- [ ] 开发者工具 Console 中没有红色错误
- [ ] Network 标签中 /parse 请求显示 200 状态
- [ ] 已选择了 PDF 文件
- [ ] 点击的是"AI解析-推荐"按钮
- [ ] 已勾选"显示调试信息"复选框查看详细日志

## 🧪 测试诊断工具

我已经创建了诊断工具，请按顺序打开：

### 1. 后端测试
```bash
python tmp_rovodev_debug_request.py
```
**预期结果：** `✅ 解析成功: 1 道题`

### 2. 前端测试
双击打开：`tmp_rovodev_diagnose_frontend.html`
**预期结果：** 所有测试显示 ✅

## 📸 如果问题仍未解决

请提供以下信息：

1. **浏览器开发者工具 Console 的截图**（红色错误）
2. **Network 标签中 /parse 请求的详情**
3. **服务器命令行输出**
4. **您的操作步骤**

### 获取详细错误信息的方法：

1. 打开 Exam.html
2. 勾选"显示调试信息"
3. 按 F12 打开开发者工具
4. 选择 PDF 文件
5. 点击"AI解析"
6. 等待错误出现
7. 查看：
   - Console 标签（红色错误）
   - Network 标签（/parse 请求）
   - 页面上的调试信息区域

## 💡 最可能的原因

根据测试，后端完全正常，最可能的原因是：

### 1. 浏览器缓存（90%可能性）
**症状：** 点击按钮后立即显示错误
**解决：** 按 Ctrl+Shift+R 强制刷新

### 2. 浏览器安全策略
**症状：** Console 显示 CORS 或安全策略错误
**解决：** 使用 Chrome 浏览器，确保 server.py 中有 CORS 配置

### 3. PDF.js 加载失败
**症状：** Console 显示 "pdfjsLib is not defined"
**解决：** 检查网络连接

## 🎯 立即尝试

**最简单的解决方法（5秒）：**

1. 按 **Ctrl + Shift + R** 强制刷新页面
2. 再次尝试

如果还不行，打开开发者工具（F12）查看 Console 中的具体错误信息。
